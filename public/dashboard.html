<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unifi Dashboard</title>
    <script src="scripts/axios.min.js"></script>
    <script src="scripts/require.js"></script>
    <script src="https://kit.fontawesome.com/d98132bac4.js" crossorigin="anonymous"></script>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <style>
        body {
            font-family: 'Roboto';
            font-size: 30px;
            background-color: black;
            color: white;
            text-align: center;
        }

        .grid-container {
            display: grid;
            grid-template-columns: auto auto auto;
            padding: 10px;
        }
        .grid-item {
            background-color: #333333;
            padding: 34px;
        }
        .grid-item-small {
            background-color: #333333;
            padding: 10px;
            font-size: 20px;
        }

        i.large {
            font-size: 50px;
            margin-bottom: 20px;
        }

        i.x-large {
            font-size: 120px;
        }

        span.uptime {
            font-size: 20px;
        }

        i.great {
            color: lightgreen;
        }

        i.warning {
            color: orange;
        }
    </style>
</head>
<body>
    <div style="display: grid; grid-template-columns: auto auto auto; grid-gap: 10px;">
        <div class="grid-item" style="grid-row: 1 / 3;">
            <i id="status" class="fad x-large" style="margin-top: 75px;"></i><br>
            <span class="status-text"></span>
        </div>
        <div class="grid-item"><i class="fad fa-download large"></i><br><span class="download-usage"></span></div>
        <div class="grid-item"><i class="fad fa-upload large"></i><br><span class="upload-usage"></span></div>
        <div class="grid-item"><i class="fad fa-users large"></i><br><span class="users"></span></div>
        <div class="grid-item"><i class="fad fa-user-secret large"></i><br><span class="guests"></span></div>
        <div class="grid-item-small"><i class="fad fa-clock"></i> <span class="uptime"></span></div>
        <div class="grid-item-small" style="grid-column: 2 / 4;"><i class="fad fa-globe-europe"></i> <span class="ip"></span></div>
        <div class="grid-item-small"><i class="fad fa-exchange"></i> <span class="speedtest-ping">-</span></div>
        <div class="grid-item-small"><i class="fad fa-download"></i> <span class="speedtest-download">-</span></div>
        <div class="grid-item-small"><i class="fad fa-upload"></i> <span class="speedtest-upload">-</span></div>
    </div>

    <script>
        const downloadUsage = document.getElementsByClassName('download-usage')[0];
        const uploadUsage = document.getElementsByClassName('upload-usage')[0];
        const uptime = document.getElementsByClassName('uptime')[0];
        const users = document.getElementsByClassName('users')[0];
        const guests = document.getElementsByClassName('guests')[0];
        const ip = document.getElementsByClassName('ip')[0];
        const speedtestPing = document.getElementsByClassName('speedtest-ping')[0];
        const speedtestDownload = document.getElementsByClassName('speedtest-download')[0];
        const speedtestUpload = document.getElementsByClassName('speedtest-upload')[0];
        const status = document.getElementById('status');
        const statusText = document.getElementsByClassName('status-text')[0];

        require.config({
            paths: {
                'axios': 'scripts/axios.min'
            }
        });

        const uptimeFunc = function(seconds) {
            function numberEnding (number) {
                return (number > 1) ? 's' : '';
            }

            var temp = Math.floor(seconds);
            var years = Math.floor(temp / 31536000);
            if (years) {
                return years + ' year' + numberEnding(years);
            }

            var days = Math.floor((temp %= 31536000) / 86400);
            if (days) {
                return days + ' day' + numberEnding(days);
            }
            var hours = Math.floor((temp %= 86400) / 3600);
            if (hours) {
                return hours + ' hour' + numberEnding(hours);
            }
            var minutes = Math.floor((temp %= 3600) / 60);
            if (minutes) {
                return minutes + ' minute' + numberEnding(minutes);
            }
            var seconds = temp % 60;
            if (seconds) {
                return seconds + ' second' + numberEnding(seconds);
            }
            return 'just now';
        }

        const getStatus = function() {
            axios.get('api/overall')
                    .then(function (response) {
                        const data = response.data;
                        downloadUsage.innerText = `${data.donwloadUsagePretty}/s`;
                        uploadUsage.innerText = `${data.uploadUsagePretty}/s`;
                        uptime.innerText = uptimeFunc(data.uptime);
                        users.innerText = data.users;
                        guests.innerText = data.guests;
                        ip.innerText = data.wanIp;
                        if (data.speedTestResult) {
                            speedtestPing.innerText = `${Math.floor(data.speedTestResult.ping)} ms`;
                            speedtestDownload.innerText = `${data.speedTestResult.downloadSpeedPretty}/s`;
                            speedtestUpload.innerText = `${data.speedTestResult.uploadSpeedPretty}/s`;
                        }
                        if (data.warnings) {
                            status.classList.remove('fa-check-circle');
                            status.classList.remove('great');
                            status.classList.add('fa-exclamation-triangle');
                            status.classList.add('warning');
                            statusText.innerText = 'Warning';
                        } else {
                            status.classList.remove('fa-exclamation-triangle');
                            status.classList.remove('warning');
                            status.classList.add('fa-check-circle');
                            status.classList.add('great');
                            statusText.innerText = 'Great';
                        }
                    });
        }
        getStatus();

        require(['axios'], function (axios) {
            setInterval(function(){
                getStatus();
            }, 30000);
        });
    </script>
</body>
</html>